{"version":3,"sources":[null,"webpack:///E:/HBuilderProjects/uni_classAttendance04/components/tui-chat/message-input/index.vue?2b55","webpack:///E:/HBuilderProjects/uni_classAttendance04/components/tui-chat/message-input/index.vue?fe36","webpack:///E:/HBuilderProjects/uni_classAttendance04/components/tui-chat/message-input/index.vue?fe39","uni-app:///components/tui-chat/message-input/index.vue","webpack:///E:/HBuilderProjects/uni_classAttendance04/components/tui-chat/message-input/index.vue?c278","webpack:///E:/HBuilderProjects/uni_classAttendance04/components/tui-chat/message-input/index.vue?7b71"],"names":["data","firstSendMessage","inputText","extensionArea","sendMessageBtn","displayFlag","isAudio","bottomVal","startPoint","popupToggle","isRecording","canSend","text","title","notShow","isShow","recordTime","recordTimer","displayServiceEvaluation","displayCommonWords","displayOrderList","components","TUIEmoji","TUICommonWords","TUIOrderList","TUIServiceEvaluation","props","conversation","type","default","watch","handler","immediate","deep","beforeMount","clearInterval","duration","tempFilePath","fileSize","uni","icon","to","conversationType","payload","file","methods","switchAudio","handleLongPress","sampleRate","numberOfChannels","encodeBitRate","format","handleTouchMove","handleTouchEnd","handleEmoji","targetFlag","handleExtensions","error","console","handleSendPicture","handleSendImage","sendImageMessage","sourceType","count","success","onProgress","message","handleShootVideo","handleSendVideo","sendVideoMessage","maxDuration","camera","handleSendOrder","appendMessage","getToAccount","handleCalling","sendTextMessage","onInputValueChange","$handleSendTextMessage","$handleSendCustomMessage","$handleCloseCards","$sendTIMMessage","detail","name","ext1","ext2","ext3","handleClose","handleServiceEvaluation","inputBindFocus","inputBindBlur"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAkH;AAClH;AACyD;AACL;AACa;;;AAGjE;AACsK;AACtK,gBAAgB,6KAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,gFAAM;AACR,EAAE,yFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,oFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAinB,CAAgB,+mBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;AC8FroB;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA,gBACA;EACAA;IACA;MACA;MACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EAEAC;IACAC;IACAC;IACAC;IACAC;EACA;EACAC;IACAC;MACAC;MACAC;IACA;EACA;EACAC;IACAH;MACAI;QACA;QACA;QACA;QACA;MAAA,CACA;MACAC;MACAC;IACA;EACA;EAEAC;IAAA;IACA;IACA;IACA;MACAC;MACA;MACA;MACA;QACAC;QACAC;QACAC;MACA;MACAC;MACA;MACA;QACA;UACAA;YACA1B;YACA2B;UACA;QACA;UACA;UACA;YACAC;YACAC;YACAC;cACAC;YACA;UACA;UACA;QACA;MACA;MAEA;QACApC;QACAC;QACAC;QACAC;QACAE;QACAD;MACA;IACA;EACA;EAEAiC;IACAC;MACA;QACAxC;QACAM;MACA;IACA;IAEAmC;MAAA;MACA;QACAX;QACA;QACAY;QACA;QACAC;QACA;QACAC;QACA;QACAC;MACA;;MACA;QACA3C;QACAK;QACA;QACA;QACAC;QACAC;QACAL;QACAD;QACAO;MACA;MACA;QACA;MACA;IACA;IAEA;IACAoC;MACA;QACA;UACA;YACAxC;YACAC;YACAF;UACA;QACA;UACA;YACAC;YACAC;YACAF;UACA;QACA;UACA;YACAC;YACAC;YACAF;UACA;QACA;MACA;IACA;IAEA;IACA0C;MACA;QACA3C;QACAD;MACA;MACA8B;MACA;IACA;IACAe;MACA;MAEA;QACAC;MACA;MAEA;QACAlD;MACA;IACA;IAEAmD;MACA;MAEA;QACAD;MACA;MAEA;QACAlD;MACA;IACA;IAEAoD;MACAC;IACA;IAEAC;MACA;IACA;IAEAC;MACA;IACA;IAEAC;MAAA;MACAtB;QACAuB;QACAC;QACAC;UACA;YACA;cACAvB;cACAC;cACAC;gBACAC;cACA;cACAqB;gBACAC;cACA;YACA;YACA;UACA;QACA;MACA;IACA;IAEAC;MACA;IACA;IAEAC;MACA;IACA;IAEAC;MAAA;MACA9B;QACAuB;QACA;QACAQ;QACA;QACAC;QACA;QACAP;UACA;YACA;cACAvB;cACAC;cACAC;gBACAC;cACA;cACAqB;gBACAC;cACA;YACA;YACA;UACA;QACA;MACA;IACA;IAEAM;MACA;QACApD;MACA;IACA;IAEAqD;MACA;QACAvE;QACAE;MACA;IACA;IAEAsE;MACA;QACA;MACA;MAEA;QACA;UACA;QAEA;UACA;QAEA;UACA;MAAA;IAEA;IACAC;MACA;MACA;QACApC;UACA1B;UACA2B;QACA;QACA;MACA;MACA;MAuBAD;QACA1B;QACA2B;MACA;MACA;IAEA;IACAoC;MACA;MACA;MACA;QACAnC;QACAC;QACAC;UACA/B;QACA;MACA;MACA;QACAV;QACAE;MACA;MACA;IACA;IAEAyE;MACA;QACA;UACAzE;QACA;MACA;QACA;UACAA;QACA;MACA;IACA;IAEA0E;MACA;MACA;QACA3D;MACA;IACA;IAEA4D;MACA;QACAtC;QACAC;QACAC;MACA;MACA;MACA;QACAvB;MACA;IACA;IAEA4D;MACA;QACA;UACA;YACA7D;UACA;UACA;QAEA;UACA;YACAC;UACA;UACA;QAEA;UACA;YACAF;UACA;UACA;QAEA;UACA;MAAA;IAEA;IAEA+D;MAAA;MACA;MACA;QACAC;UACAhB;QACA;MACA;MACA3B;QACA;UACAA;YACA4C;YACAC;YACAC;YACAC;UACA;QACA;QACA;MACA;QACA/C;UACA4C;UACAC;UACAC;UACAC;QACA;MACA;MACA;QACAjF;MACA;IACA;IAEAkF;MACA;QACAlF;MACA;IACA;IAEAmF;MACA;QACAtE;MACA;IACA;IAEAuE;MACA/B;IACA;IAEAgC;MACAhC;IACA;EACA;AACA;AAAA,4B;;;;;;;;;;;;;ACjiBA;AAAA;AAAA;AAAA;AAA04B,CAAgB,o2BAAG,EAAC,C;;;;;;;;;;;ACA95B;AACA,OAAO,KAAU,EAAE,kBAKd","file":"components/tui-chat/message-input/index.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=1da00aa0&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/tui-chat/message-input/index.vue\"\nexport default component.exports","export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=template&id=1da00aa0&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<view class=\"TUI-message-input-container\">\r\n\t\t\t<view class=\"TUI-message-input\">\r\n\t\t\t\t<image class=\"TUI-icon\" @tap=\"switchAudio\" :src=\"isAudio ? '/static/static/assets/keyboard.svg' : '/static/static/assets/audio.svg'\"></image>\r\n\t\t\t\t<view v-if=\"!isAudio\" class=\"TUI-message-input-main\">\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\tclass=\"TUI-message-input-area\"\r\n\t\t\t\t\t\t:adjust-position=\"true\"\r\n\t\t\t\t\t\tcursor-spacing=\"20\"\r\n\t\t\t\t\t\tv-model=\"inputText\"\r\n\t\t\t\t\t\t@input=\"onInputValueChange\"\r\n\t\t\t\t\t\tmaxlength=\"140\"\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\tplaceholder-class=\"input-placeholder\"\r\n\t\t\t\t\t\tplaceholder=\"说点什么呢~\"\r\n\t\t\t\t\t\t@focus=\"inputBindFocus\"\r\n\t\t\t\t\t\t@blur=\"inputBindBlur\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view\r\n\t\t\t\t\tv-else\r\n\t\t\t\t\tclass=\"TUI-message-input-main\"\r\n\t\t\t\t\t@longpress=\"handleLongPress\"\r\n\t\t\t\t\t@touchmove=\"handleTouchMove\"\r\n\t\t\t\t\t@touchend=\"handleTouchEnd\"\r\n\t\t\t\t\tstyle=\"display: flex; justify-content: center; font-size: 32rpx; font-family: PingFangSC-Regular;\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<text>{{ text }}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"TUI-message-input-functions\" hover-class=\"none\">\r\n\t\t\t\t\t<image class=\"TUI-icon\" @tap=\"handleEmoji\" src=\"/static/static/assets/face-emoji.svg\"></image>\r\n\t\t\t\t\t<view v-if=\"!sendMessageBtn\" @tap=\"handleExtensions\"><image class=\"TUI-icon\" src=\"/static/static/assets/more.svg\"></image></view>\r\n\t\t\t\t\t<view v-else class=\"TUI-sendMessage-btn\" @tap=\"sendTextMessage\">发送</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view v-if=\"displayFlag === 'emoji'\" class=\"TUI-Emoji-area\"><TUI-Emoji @enterEmoji=\"appendMessage\"></TUI-Emoji></view>\r\n\t\t\t<view v-if=\"displayFlag === 'extension'\" class=\"TUI-Extensions\">\r\n\t\t\t\t<!-- TODO: 这里功能还没实现 -->\r\n\t\t\t\t<!--        <camera device-position=\"back\" flash=\"off\" binderror=\"error\" style=\"width: 100%; height: 300px;\"></camera>-->\r\n\t\t\t\t<view class=\"TUI-Extension-slot\" @tap=\"handleSendPicture\">\r\n\t\t\t\t\t<image class=\"TUI-Extension-icon\" src=\"/static/static/assets/take-photo.svg\"></image>\r\n\t\t\t\t\t<view class=\"TUI-Extension-slot-name\">拍摄照片</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"TUI-Extension-slot\" @tap=\"handleSendImage\">\r\n\t\t\t\t\t<image class=\"TUI-Extension-icon\" src=\"/static/static/assets/send-img.svg\"></image>\r\n\t\t\t\t\t<view class=\"TUI-Extension-slot-name\">发送图片</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"TUI-Extension-slot\" @tap=\"handleShootVideo\">\r\n\t\t\t\t\t<image class=\"TUI-Extension-icon\" src=\"/static/static/assets/take-video.svg\"></image>\r\n\t\t\t\t\t<view class=\"TUI-Extension-slot-name\">拍摄视频</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"TUI-Extension-slot\" @tap=\"handleSendVideo\">\r\n\t\t\t\t\t<image class=\"TUI-Extension-icon\" src=\"/static/static/assets/send-video.svg\"></image>\r\n\t\t\t\t\t<view class=\"TUI-Extension-slot-name\">发送视频</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"TUI-Extension-slot\" @tap=\"handleCalling(1)\">\r\n\t\t\t\t\t<image class=\"TUI-Extension-icon\" src=\"/static/static/assets/audio-calling.svg\"></image>\r\n\t\t\t\t\t<view class=\"TUI-Extension-slot-name\">语音通话</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"TUI-Extension-slot\" @tap=\"handleCalling(2)\">\r\n\t\t\t\t\t<image class=\"TUI-Extension-icon\" src=\"/static/static/assets/video-calling.svg\"></image>\r\n\t\t\t\t\t<view class=\"TUI-Extension-slot-name\">视频通话</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"TUI-Extension-slot\" @tap=\"handleServiceEvaluation\">\r\n\t\t\t\t\t<image class=\"TUI-Extension-icon\" src=\"/static/static/assets/service-assess.svg\"></image>\r\n\t\t\t\t\t<view class=\"TUI-Extension-slot-name\">服务评价</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"TUI-Extension-slot\" @tap=\"handleSendOrder\">\r\n\t\t\t\t\t<image class=\"TUI-Extension-icon\" src=\"/static/static/assets/send-order.svg\"></image>\r\n\t\t\t\t\t<view class=\"TUI-Extension-slot-name\">发送订单</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<TUI-Common-Words class=\"tui-cards\" :display=\"displayCommonWords\" @sendMessage=\"$handleSendTextMessage\" @close=\"$handleCloseCards\"></TUI-Common-Words>\r\n\t\t\t<TUI-Order-List class=\"tui-cards\" :display=\"displayOrderList\" @sendCustomMessage=\"$handleSendCustomMessage\" @close=\"$handleCloseCards\"></TUI-Order-List>\r\n\t\t\t<TUI-Service-Evaluation\r\n\t\t\t\tclass=\"tui-cards\"\r\n\t\t\t\t:display=\"displayServiceEvaluation\"\r\n\t\t\t\t@sendCustomMessage=\"$handleSendCustomMessage\"\r\n\t\t\t\t@close=\"$handleCloseCards\"\r\n\t\t\t></TUI-Service-Evaluation>\r\n\t\t</view>\r\n\t\t<view class=\"record-modal\" v-if=\"popupToggle\" @longpress=\"handleLongPress\" @touchmove=\"handleTouchMove\" @touchend=\"handleTouchEnd\">\r\n\t\t\t<view class=\"wrapper\"><view class=\"modal-loading\"></view></view>\r\n\t\t\t<view class=\"modal-title\">{{ title }}</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nimport TUIEmoji from '../message-elements/emoji/index';\r\nimport TUICommonWords from '../message-private/common-words/index';\r\nimport TUIOrderList from '../message-private/order-list/index';\r\nimport TUIServiceEvaluation from '../message-private/service-evaluation/index';\r\nimport logger from '../../../utils/logger';\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\t// todo  conversation\r\n\t\t\t// conversation: {},\r\n\t\t\tfirstSendMessage: true,\r\n\t\t\tinputText: '',\r\n\t\t\textensionArea: false,\r\n\t\t\tsendMessageBtn: false,\r\n\t\t\tdisplayFlag: '',\r\n\t\t\tisAudio: false,\r\n\t\t\tbottomVal: 0,\r\n\t\t\tstartPoint: 0,\r\n\t\t\tpopupToggle: false,\r\n\t\t\tisRecording: false,\r\n\t\t\tcanSend: true,\r\n\t\t\ttext: '按住说话',\r\n\t\t\ttitle: ' ',\r\n\t\t\tnotShow: false,\r\n\t\t\tisShow: true,\r\n\t\t\trecordTime: 0,\r\n\t\t\trecordTimer: null,\r\n\t\t\tdisplayServiceEvaluation: false,\r\n\t\t\tdisplayCommonWords: false,\r\n\t\t\tdisplayOrderList: false\r\n\t\t};\r\n\t},\r\n\r\n\tcomponents: {\r\n\t\tTUIEmoji,\r\n\t\tTUICommonWords,\r\n\t\tTUIOrderList,\r\n\t\tTUIServiceEvaluation\r\n\t},\r\n\tprops: {\r\n\t\tconversation: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault: () => {}\r\n\t\t}\r\n\t},\r\n\twatch: {\r\n\t\tconversation: {\r\n\t\t\thandler: function(newVal) {\r\n\t\t\t\t// todo 值会被改变\r\n\t\t\t\t// this.setData({\r\n\t\t\t\t//   conversation: newVal\r\n\t\t\t\t// });\r\n\t\t\t},\r\n\t\t\timmediate: true,\r\n\t\t\tdeep: true\r\n\t\t}\r\n\t},\r\n\r\n\tbeforeMount() {\r\n\t\t// 加载声音录制管理器\r\n\t\tthis.recorderManager = uni.getRecorderManager();\r\n\t\tthis.recorderManager.onStop(res => {\r\n\t\t\tclearInterval(this.recordTimer);\r\n\t\t\t// 兼容 uniapp 打包app，duration 和 fileSize 需要用户自己补充\r\n\t\t\t// 文件大小 ＝ (音频码率) x 时间长度(单位:秒) / 8\r\n\t\t\tlet msg = {\r\n\t\t\t\tduration: res.duration ? res.duration : this.recordTime * 1000,\r\n\t\t\t\ttempFilePath: res.tempFilePath,\r\n\t\t\t\tfileSize: res.fileSize ? res.fileSize : ((48 * this.recordTime) / 8) * 1024\r\n\t\t\t};\r\n\t\t\tuni.hideLoading();\r\n\t\t\t// 兼容 uniapp 语音消息没有duration\r\n\t\t\tif (this.canSend) {\r\n\t\t\t\tif (msg.duration < 1000) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '录音时间太短',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// res.tempFilePath 存储录音文件的临时路径\r\n\t\t\t\t\tconst message = uni.$TUIKit.createAudioMessage({\r\n\t\t\t\t\t\tto: this.getToAccount(),\r\n\t\t\t\t\t\tconversationType: this.conversation.type,\r\n\t\t\t\t\t\tpayload: {\r\n\t\t\t\t\t\t\tfile: msg\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.$sendTIMMessage(message);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.setData({\r\n\t\t\t\tstartPoint: 0,\r\n\t\t\t\tpopupToggle: false,\r\n\t\t\t\tisRecording: false,\r\n\t\t\t\tcanSend: true,\r\n\t\t\t\ttitle: ' ',\r\n\t\t\t\ttext: '按住说话'\r\n\t\t\t});\r\n\t\t});\r\n\t},\r\n\r\n\tmethods: {\r\n\t\tswitchAudio() {\r\n\t\t\tthis.setData({\r\n\t\t\t\tisAudio: !this.isAudio,\r\n\t\t\t\ttext: '按住说话'\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\thandleLongPress(e) {\r\n\t\t\tthis.recorderManager.start({\r\n\t\t\t\tduration: 60000,\r\n\t\t\t\t// 录音的时长，单位 ms，最大值 600000（10 分钟）\r\n\t\t\t\tsampleRate: 44100,\r\n\t\t\t\t// 采样率\r\n\t\t\t\tnumberOfChannels: 1,\r\n\t\t\t\t// 录音通道数\r\n\t\t\t\tencodeBitRate: 192000,\r\n\t\t\t\t// 编码码率\r\n\t\t\t\tformat: 'aac' // 音频格式，选择此格式创建的音频消息，可以在即时通信 IM 全平台（Android、iOS、微信小程序和Web）互通\r\n\t\t\t});\r\n\t\t\tthis.setData({\r\n\t\t\t\tstartPoint: e.touches[0],\r\n\t\t\t\ttitle: '正在录音',\r\n\t\t\t\t// isRecording : true,\r\n\t\t\t\t// canSend: true,\r\n\t\t\t\tnotShow: true,\r\n\t\t\t\tisShow: false,\r\n\t\t\t\tisRecording: true,\r\n\t\t\t\tpopupToggle: true,\r\n\t\t\t\trecordTime: 0\r\n\t\t\t});\r\n\t\t\tthis.recordTimer = setInterval(() => {\r\n\t\t\t\tthis.recordTime++;\r\n\t\t\t}, 1000);\r\n\t\t},\r\n\r\n\t\t// 录音时的手势上划移动距离对应文案变化\r\n\t\thandleTouchMove(e) {\r\n\t\t\tif (this.isRecording) {\r\n\t\t\t\tif (this.startPoint.clientY - e.touches[e.touches.length - 1].clientY > 100) {\r\n\t\t\t\t\tthis.setData({\r\n\t\t\t\t\t\ttext: '抬起停止',\r\n\t\t\t\t\t\ttitle: '松开手指，取消发送',\r\n\t\t\t\t\t\tcanSend: false\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (this.startPoint.clientY - e.touches[e.touches.length - 1].clientY > 20) {\r\n\t\t\t\t\tthis.setData({\r\n\t\t\t\t\t\ttext: '抬起停止',\r\n\t\t\t\t\t\ttitle: '上划可取消',\r\n\t\t\t\t\t\tcanSend: true\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.setData({\r\n\t\t\t\t\t\ttext: '抬起停止',\r\n\t\t\t\t\t\ttitle: '正在录音',\r\n\t\t\t\t\t\tcanSend: true\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// 手指离开页面滑动\r\n\t\thandleTouchEnd() {\r\n\t\t\tthis.setData({\r\n\t\t\t\tisRecording: false,\r\n\t\t\t\tpopupToggle: false\r\n\t\t\t});\r\n\t\t\tuni.hideLoading();\r\n\t\t\tthis.recorderManager.stop();\r\n\t\t},\r\n\t\thandleEmoji() {\r\n\t\t\tlet targetFlag = 'emoji';\r\n\r\n\t\t\tif (this.displayFlag === 'emoji') {\r\n\t\t\t\ttargetFlag = '';\r\n\t\t\t}\r\n\r\n\t\t\tthis.setData({\r\n\t\t\t\tdisplayFlag: targetFlag\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\thandleExtensions() {\r\n\t\t\tlet targetFlag = 'extension';\r\n\r\n\t\t\tif (this.displayFlag === 'extension') {\r\n\t\t\t\ttargetFlag = '';\r\n\t\t\t}\r\n\r\n\t\t\tthis.setData({\r\n\t\t\t\tdisplayFlag: targetFlag\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\terror(e) {\r\n\t\t\tconsole.log(e.detail);\r\n\t\t},\r\n\r\n\t\thandleSendPicture() {\r\n\t\t\tthis.sendImageMessage('camera');\r\n\t\t},\r\n\r\n\t\thandleSendImage() {\r\n\t\t\tthis.sendImageMessage('album');\r\n\t\t},\r\n\r\n\t\tsendImageMessage(type) {\r\n\t\t\tuni.chooseImage({\r\n\t\t\t\tsourceType: [type],\r\n\t\t\t\tcount: 1,\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tif (res) {\r\n\t\t\t\t\t\tconst message = uni.$TUIKit.createImageMessage({\r\n\t\t\t\t\t\t\tto: this.getToAccount(),\r\n\t\t\t\t\t\t\tconversationType: this.conversation.type,\r\n\t\t\t\t\t\t\tpayload: {\r\n\t\t\t\t\t\t\t\tfile: res\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tonProgress: percent => {\r\n\t\t\t\t\t\t\t\tmessage.percent = percent;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tthis.$sendTIMMessage(message);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\thandleShootVideo() {\r\n\t\t\tthis.sendVideoMessage('camera');\r\n\t\t},\r\n\r\n\t\thandleSendVideo() {\r\n\t\t\tthis.sendVideoMessage('album');\r\n\t\t},\r\n\r\n\t\tsendVideoMessage(type) {\r\n\t\t\tuni.chooseVideo({\r\n\t\t\t\tsourceType: [type],\r\n\t\t\t\t// 来源相册或者拍摄\r\n\t\t\t\tmaxDuration: 60,\r\n\t\t\t\t// 设置最长时间60s\r\n\t\t\t\tcamera: 'back',\r\n\t\t\t\t// 后置摄像头\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tif (res) {\r\n\t\t\t\t\t\tconst message = uni.$TUIKit.createVideoMessage({\r\n\t\t\t\t\t\t\tto: this.getToAccount(),\r\n\t\t\t\t\t\t\tconversationType: this.conversation.type,\r\n\t\t\t\t\t\t\tpayload: {\r\n\t\t\t\t\t\t\t\tfile: res\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tonProgress: percent => {\r\n\t\t\t\t\t\t\t\tmessage.percent = percent;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tthis.$sendTIMMessage(message);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\thandleSendOrder() {\r\n\t\t\tthis.setData({\r\n\t\t\t\tdisplayOrderList: true\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tappendMessage(e) {\r\n\t\t\tthis.setData({\r\n\t\t\t\tinputText: this.inputText + e.detail.message,\r\n\t\t\t\tsendMessageBtn: true\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetToAccount() {\r\n\t\t\tif (!this.conversation || !this.conversation.conversationID) {\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\r\n\t\t\tswitch (this.conversation.type) {\r\n\t\t\t\tcase 'C2C':\r\n\t\t\t\t\treturn this.conversation.conversationID.replace('C2C', '');\r\n\r\n\t\t\t\tcase 'GROUP':\r\n\t\t\t\t\treturn this.conversation.conversationID.replace('GROUP', '');\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn this.conversation.conversationID;\r\n\t\t\t}\r\n\t\t},\r\n\t\thandleCalling(value) {\r\n\t\t\t// todo 目前支持单聊\r\n\t\t\tif (this.conversation.type === 'GROUP') {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '群聊暂不支持',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst { userID } = this.conversation.userProfile;\r\n\r\n\t\t\t// #ifdef APP-PLUS\r\n\t\t\tif(typeof(uni.$TUICallKit) === 'undefined') {\r\n\t\t\t\t\tlogger.error('请使用真机运行并且自定义基座调试，可能影响音视频功能～ 插件地址：https://ext.dcloud.net.cn/plugin?id=7097 , 调试地址：https://nativesupport.dcloud.net.cn/NativePlugin/use/use');\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '请使用真机运行并且自定义基座调试，可能影响音视频功能～ ',\r\n\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\tduration: 3000\r\n\t\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tuni.$TUICallKit.call(\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tuserID: userID,\r\n\t\t\t\t\t\tcallMediaType: value\r\n\t\t\t\t\t},\r\n\t\t\t\t\tres => {\r\n\t\t\t\t\t\tconsole.log(JSON.stringify(res));\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\t// #endif\r\n\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '微信小程序暂不支持',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t});\r\n\t\t\t// uni.$wxTUICalling.call({userID, type: value})\r\n\t\t\t// #endif\r\n\t\t},\r\n\t\tsendTextMessage(msg, flag) {\r\n\t\t\tconst to = this.getToAccount();\r\n\t\t\tconst text = flag ? msg : this.inputText;\r\n\t\t\tconst message = uni.$TUIKit.createTextMessage({\r\n\t\t\t\tto,\r\n\t\t\t\tconversationType: this.conversation.type,\r\n\t\t\t\tpayload: {\r\n\t\t\t\t\ttext\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis.setData({\r\n\t\t\t\tinputText: '',\r\n\t\t\t\tsendMessageBtn: false\r\n\t\t\t});\r\n\t\t\tthis.$sendTIMMessage(message);\r\n\t\t},\r\n\r\n\t\tonInputValueChange(event) {\r\n\t\t\tif (event.detail.value) {\r\n\t\t\t\tthis.setData({\r\n\t\t\t\t\tsendMessageBtn: true\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tthis.setData({\r\n\t\t\t\t\tsendMessageBtn: false\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t$handleSendTextMessage(event) {\r\n\t\t\tthis.sendTextMessage(event.detail.message, true);\r\n\t\t\tthis.setData({\r\n\t\t\t\tdisplayCommonWords: false\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t$handleSendCustomMessage(e) {\r\n\t\t\tconst message = uni.$TUIKit.createCustomMessage({\r\n\t\t\t\tto: this.getToAccount(),\r\n\t\t\t\tconversationType: this.conversation.type,\r\n\t\t\t\tpayload: e.detail.payload\r\n\t\t\t});\r\n\t\t\tthis.$sendTIMMessage(message);\r\n\t\t\tthis.setData({\r\n\t\t\t\tdisplayOrderList: false\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t$handleCloseCards(e) {\r\n\t\t\tswitch (e.detail.key) {\r\n\t\t\t\tcase '0':\r\n\t\t\t\t\tthis.setData({\r\n\t\t\t\t\t\tdisplayCommonWords: false\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '1':\r\n\t\t\t\t\tthis.setData({\r\n\t\t\t\t\t\tdisplayOrderList: false\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '2':\r\n\t\t\t\t\tthis.setData({\r\n\t\t\t\t\t\tdisplayServiceEvaluation: false\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t$sendTIMMessage(message) {\r\n\t\t\tconst SDKAppID = getApp().globalData.SDKAppID;\r\n\t\t\tthis.$emit('sendMessage', {\r\n\t\t\t\tdetail: {\r\n\t\t\t\t\tmessage\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tuni.$TUIKit.sendMessage(message).then((res) => {\r\n\t\t\t\tif(this.firstSendMessage) {\r\n\t\t\t\t\tuni.$aegis.reportEvent({\r\n\t\t\t\t\t    name: 'sendMessage',\r\n\t\t\t\t\t    ext1: 'sendMessage-success',\r\n\t\t\t\t\t    ext2: 'uniTuikitExternal',\r\n\t\t\t\t\t    ext3: `${SDKAppID}`,\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\tthis.firstSendMessage = false\r\n\t\t\t}).catch((error) => {\r\n\t\t\t\tuni.$aegis.reportEvent({\r\n\t\t\t\t\t\tname: 'sendMessage',\r\n\t\t\t\t\t\text1: `sendMessage-failed#error: ${error}`,\r\n\t\t\t\t\t\text2: 'uniTuikitExternal',\r\n\t\t\t\t\t\text3: `${SDKAppID}`,\r\n\t\t\t  })\r\n\t\t\t})\r\n\t\t\tthis.setData({\r\n\t\t\t\tdisplayFlag: ''\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\thandleClose() {\r\n\t\t\tthis.setData({\r\n\t\t\t\tdisplayFlag: ''\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\thandleServiceEvaluation() {\r\n\t\t\tthis.setData({\r\n\t\t\t\tdisplayServiceEvaluation: true\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tinputBindFocus() {\r\n\t\t\tconsole.log('占位：函数 inputBindFocus 未声明');\r\n\t\t},\r\n\r\n\t\tinputBindBlur() {\r\n\t\t\tconsole.log('占位：函数 inputBindBlur 未声明');\r\n\t\t}\r\n\t}\r\n};\r\n</script>\r\n<style>\r\n@import './index.css';\r\n</style>\r\n","import mod from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1679302543769\n      var cssReload = require(\"E:/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}